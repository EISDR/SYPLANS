<div style="margin-top: -10px; margin-left: 5px;">
    <button class="btn btn-primary" ng-click="<%= scope %>.OpenPonderaciones()" style="float: left">
        Ver Detalles de las Ponderaciones
    </button>
</div>
<div style="margin-top: -10px; margin-left: 5px;">
    <button class="btn btn-primary" ng-click=" <%= scope %>.ui.goHome();" style="float: right">
        Volver al inicio
    </button>
</div>
<br>
<div class="titulo text-center">
    <h1>{{<%= scope %>.REPORTING.titulo}}</h1>
</div>

<!-- Busqueda -->
<div class="col-md-8" style="padding: 0; margin-bottom: 10px; margin-top: 15px;">
    <div class="panel panel-white" style="margin-bottom: 0; position: static; zoom: 1;">
        <div class="panel-heading" style="padding: 10px 20px">
            <h6 style="font-size: 16px;font-weight: bold; color: #333;" class="panel-title">
                Búsqueda </h6>
        </div>
        <div class="panel-body panelContainer" style="padding: 15px; display: flex; flex-direction: column;"
             ng-show="<%= scope %>.unicomenu">
            <div class="row" ng-show="<%= scope %>.unicomenu==='evento'">
                <div class='col-sm-12 col-md-12' ng-show="<%= scope %>.REPORTING.entidad==='Eventos'">
                    <label>Tipo de evento</label>
                    <select3 class="form-control" ng-model="<%= scope %>.inputBuscado"
                             s2-options="opt.nombre as opt.nombre for opt in  <%= scope %>.REPORTING.elementos">
                    </select3>
                </div>
                <div class='col-sm-9 col-md-9' ng-show="<%= scope %>.REPORTING.entidad!=='Eventos'">
                    <label>Escriba aquí su criterio de búsqueda</label>
                    <input type="search"
                           class="form-control busquedaInput"
                           placeholder="Escriba aquí su criterio de búsqueda"
                           ng-model="<%= scope %>.inputBuscado"
                           ng-change=""
                           ng-model-onblur>
                </div>
                <div class='col-sm-3 col-md-3 ' ng-show="<%= scope %>.REPORTING.entidad!=='Eventos'">
                    <label>Filtrar por el año del indicador</label>
                    <input type="number"
                           class="form-control busquedaInput"
                           placeholder="Año a filtrar"
                           ng-model="<%= scope %>.inputYear"
                           ng-model-onblur>
                </div>
            </div>
            <div class="row" ng-show="<%= scope %>.unicomenu!=='evento'">
                <div class='col-sm-9 col-md-9'>
                    <label>Escriba aquí su criterio de búsqueda</label>
                    <input type="search"
                           class="form-control busquedaInput"
                           placeholder="Escriba aquí su criterio de búsqueda"
                           ng-model="<%= scope %>.inputBuscado"
                           ng-model-onblur>
                </div>
                <div class='col-sm-3 col-md-3 '>
                    <label>Filtrar por el año del indicador</label>
                    <input type="number"
                           class="form-control busquedaInput"
                           placeholder="Año a filtrar"
                           ng-model="<%= scope %>.inputYear"
                           ng-model-onblur>
                </div>
            </div>
            <div style="margin-top: 5px; margin-left: 5px;" ng-show="<%= scope %>.REPORTING.entidad!=='Eventos'">
                <button class="btn btn-primary">Buscar</button>
            </div>
        </div>
        <div class="panel-body panelContainer" style="padding: 15px; display: flex; flex-direction: column;"
             ng-show="!<%= scope %>.unicomenu">
            <div class='col-sm-12 col-md-12'>
                <input type="search"
                       class="form-control busquedaInput"
                       placeholder="Escriba aquí su criterio de búsqueda"
                       ng-model="<%= scope %>.inputBuscado"
                       ng-model-onblur>
            </div>
            <div style="margin-top: 5px; margin-left: 5px;">
                <button class="btn btn-primary">Buscar</button>
            </div>
        </div>
    </div>
</div>

<!-- Ordenamientos -->
<div class="col-md-4" style="padding: 0; margin-bottom: 10px; margin-top: 15px;">
    <div class="panel panel-white" style="margin-bottom: 0; position: static; zoom: 1;">
        <div class="panel-heading" style="padding: 10px 20px">
            <h6 style="font-size: 16px;font-weight: bold; color: #333;" class="panel-title">Ordenar</h6>
        </div>
        <div class="col-md-12" style="padding: 0;">
            <button type="button" ng-click="<%= scope %>.sortGrafico('nombre')"
                    class="btn btn-{{<%= scope %>.REPORTING.sorting==='nombreasc' ?'primary':'gray'}}"
                    title="Por Nombre Ascendente" style="width: 100%;padding: 4px;border-radius: 0 !important;">
                <b><i class="icon-sort-alpha-asc"></i></b> Por Nombre Ascendent
            </button>
        </div>
        <div class="col-md-12" style="padding: 0;">
            <button type="button" ng-click="<%= scope %>.sortGrafico('nombre',true)"
                    class="btn btn-{{<%= scope %>.REPORTING.sorting==='nombredesc'?'primary':'gray'}}"
                    title="Por Nombre Descendente" style="width: 100%;padding: 4px;border-radius: 0 !important;">
                <b><i class="icon-sort-alpha-desc"></i></b> Por Nombre Descendente
            </button>
        </div>
        <div class="col-md-12" style="padding: 0;">
            <button type="button" ng-click="<%= scope %>.sortGrafico('porcentaje')"
                    class="btn btn-{{<%= scope %>.REPORTING.sorting==='cumplimientoasc'?'primary':'gray'}}"
                    title="Por Cumplimiento Ascendente" style="width: 100%;padding: 4px;border-radius: 0 !important;">
                <b><i class="icon-arrow-down7"></i></b> Por Cumplimiento Ascendente
            </button>
        </div>
        <div class="col-md-12" style="padding: 0;">
            <button type="button" ng-click="<%= scope %>.sortGrafico('porcentaje',true)"
                    class="btn btn-{{<%= scope %>.REPORTING.sorting==='cumplimientodesc'?'primary':'gray'}}"
                    title="Por Cumplimiento Descendente" style="width: 100%;padding: 4px;border-radius: 0 !important;">
                <b><i class="icon-arrow-up7"></i></b> Por Cumplimiento Descendente
            </button>
        </div>
    </div>

</div>

<!-- Graficos -->
<div class="row" ng-if="!<%= scope %>.modolista">
    <div class="col-xs-12 col-sm-12 col-md-12" style="text-align: left;margin: 10px">
        <button class="btn btn-info" ng-click="<%= scope %>.toggleNull();" style="float: right">
            {{<%= scope %>.mostrarnulltext}}
        </button>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-12">
        <div class="col-xs-12 col-sm-3 col-md-3" style="margin-top: 10px; padding: 0;"
             ng-repeat="(index,value) in <%= scope %>.REPORTING.elementos"
             ng-show="((<%= scope %>.inputBuscado === undefined || (value.nombre.toLowerCase().includes(<%= scope %>.inputBuscado.toLowerCase()) || value.porcentaje.toString().includes(<%= scope %>.inputBuscado) || value.titulo_ponderacion.toLowerCase().includes(<%= scope %>.inputBuscado.toLowerCase()) )) && (!<%= scope %>.mostrarnull?true:(value.porcentaje===''?false:true))) && ((<%= scope %>.inputYear !==null && <%= scope %>.inputYear !==undefined) ? value.year==<%= scope %>.inputYear:true)">
            <div class="panel panel-default">
                <div class="panel-heading text-center"
                     style="padding: 2px 0 0 8px; border-top-left-radius: 20px; border-top-right-radius: 20px;">
                    <h5 title="{{value.nombre}}"
                        style=" height: 26px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                        <b>{{value.nombre}}</b>
                        <b ng-show="<%= scope %>.unicomenu && <%= scope %>.REPORTING.entidad!=='Eventos'">
                            ({{value.year}})</b>
                    </h5>
                </div>
                <div class="panel-body text-center">
                    <div class="row">
                        <div class="col-sm-12 col-md-12 grafe" id="{{value.divID}}">
                        </div>
                        <h4>{{value.titulo_ponderacion}}</h4>
                        <div class="col-sm-12 col-md-12">
                            <button class="btn btn-primary" ng-if="value.boton"
                                    ng-click="<%= scope %>.execute(value.link)"
                                    style="width: 100%;">
                                {{value.boton}}
                            </button>
                        </div>
                        <div class="col-sm-12 col-md-12" style="margin-top: 5px;">
                            <button class="btn btn-primary" ng-if="value.boton2"
                                    ng-click="<%= scope %>.execute(value.link2)"
                                    style="width: 100%;">
                                {{value.boton2}}
                            </button>
                        </div>
                        <button class="btn btn-primary" ng-if="value.boton3"
                                ng-click="<%= scope %>.calcs.ficha(value.boton3.list,value.boton3.field,value.boton3.id,value.boton3.pei)"
                                style="width: 100%;">
                            Ver Detalle
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row" ng-if="<%= scope %>.modolista">
    <div class="col-xs-12 col-sm-12 col-md-12" style="text-align: left;margin: 10px">
        <button class="btn btn-info" ng-click="<%= scope %>.toggleNull();" style="float: right">
            {{<%= scope %>.mostrarnulltext}}
        </button>
        <button class="btn btn-success" ng-click="<%= scope %>.exportXLS();" style="float: right">
            <i class="icon-file-excel"></i>Exportar a Excel
        </button>

    </div>
    <div class="col-xs-12 col-sm-12 col-md-12">
        <table class="table table-togglable table-framed" ng-if="<%= scope %>.REPORTING.elementos.length">
            <thead>
            <tr class="bg-<%= COLOR.secundary %> dragon-columns">
                <th>{{<%= scope %>.REPORTING.entidad}}</th>
                <th ng-if="<%= scope %>.REPORTING.entidad==='Producto'">Tipo</th>
                <th ng-if="<%= scope %>.REPORTING.elementos[0].boton">
                    {{<%= scope %>.REPORTING.elementos[0].boton.split("Ver ")[1].split("(")[0]}}
                </th>
                <th ng-if="<%= scope %>.REPORTING.elementos[0].boton2">
                    {{<%= scope %>.REPORTING.elementos[0].boton2.split("Ver ")[1].split("(")[0]}}
                </th>
                <th>Cumplimiento</th>

                <th ng-if="<%= scope %>.REPORTING.elementos[0].boton3">Acción</th>
            </tr>
            </thead>
            <tbody>
            <tr ng-repeat="(index,value) in <%= scope %>.REPORTING.elementos"
                ng-show="((<%= scope %>.inputBuscado === undefined || (value.nombre.toLowerCase().includes(<%= scope %>.inputBuscado.toLowerCase()) || value.porcentaje.toString().includes(<%= scope %>.inputBuscado) || value.titulo_ponderacion.toLowerCase().includes(<%= scope %>.inputBuscado.toLowerCase()) )) && (!<%= scope %>.mostrarnull?true:(value.porcentaje===''?false:true))) && ((<%= scope %>.inputYear !==null && <%= scope %>.inputYear !==undefined) ? value.year==<%= scope %>.inputYear:true)"
            >
                <td>{{value.nombre}}</td>
                <td ng-if="<%= scope %>.REPORTING.entidad==='Producto'">{{value.estrategico}}</td>
                <td ng-if="value.boton">
                    <a title="Dar clic para ver detalle" ng-click="<%= scope %>.execute(value.link)">{{value.boton.split("(")[1].split(")")[0]}}</a>
                </td>
                <td ng-if="value.boton2">
                    <a title="Dar clic para ver detalle" ng-click="<%= scope %>.execute(value.link2)">{{value.boton2.split("(")[1].split(")")[0]}}</a>
                </td>
                <td style="background-color: {{value.color}};color:{{value.porcentaje===''?'black':'white'}};font-weight: bold">
                    {{value.porcentaje}}{{value.porcentaje===''?'Pendiente':'%'}}
                </td>
                <td ng-if="value.boton3">
                    <button class="btn btn-primary"
                            ng-click="<%= scope %>.calcs.ficha(value.boton3.list,value.boton3.field,value.boton3.id,value.boton3.pei)"
                            style="width: 100%;">
                        Ver Detalle
                    </button>
                </td>
            </tr>
            </tbody>
        </table>

        <table class="table table-togglable table-framed" id="exportelementos"
               style="visibility: hidden">
            <thead>
            <tr class="bg-<%= COLOR.secundary %> dragon-columns"
            >
                <th style="background-color: #9c282d;border-color: #9c282d;color: #FFF !important;">{{<%= scope %>
                    .REPORTING.entidad}}
                </th>
                <th ng-if="<%= scope %>.REPORTING.entidad==='Producto'">Tipo</th>
                <th style="background-color: #9c282d;border-color: #9c282d;color: #FFF !important;"
                    ng-if="<%= scope %>.REPORTING.elementos[0].boton">
                    {{<%= scope %>.REPORTING.elementos[0].boton.split("Ver ")[1].split("(")[0]}}
                </th>
                <th style="background-color: #9c282d;border-color: #9c282d;color: #FFF !important;"
                    ng-if="<%= scope %>.REPORTING.elementos[0].boton2">
                    {{<%= scope %>.REPORTING.elementos[0].boton2.split("Ver ")[1].split("(")[0]}}
                </th>
                <th style="background-color: #9c282d;border-color: #9c282d;color: #FFF !important;">Cumplimiento</th>
            </tr>
            </thead>
            <tbody>
            <tr ng-repeat="(index,value) in <%= scope %>.REPORTING.elementos"
                ng-if="(<%= scope %>.inputBuscado === undefined || (value.nombre.toLowerCase().includes(<%= scope %>.inputBuscado.toLowerCase()) || value.porcentaje.toString().includes(<%= scope %>.inputBuscado) || value.titulo_ponderacion.toLowerCase().includes(<%= scope %>.inputBuscado.toLowerCase()) )) && ((<%= scope %>.inputYear !==null && <%= scope %>.inputYear !==undefined) ? value.year==<%= scope %>.inputYear:true)"
            >
                <td>{{value.nombre}}</td>
                <td ng-if="<%= scope %>.REPORTING.entidad==='Producto'">{{value.estrategico}}</td>
                <td ng-if="value.boton">
                    {{value.boton.split("(")[1].split(")")[0]}}
                </td>
                <td ng-if="value.boton2">
                    {{value.boton2.split("(")[1].split(")")[0]}}
                </td>
                <td style="background-color: {{value.color}};color:white;font-weight: bold">{{value.porcentaje}}%</td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    setTimeout(() => {
        <%= scope %>.
        loadAllThis(<%= scope %>.REPORTING.elementos
    )
        ;
        if (<%= scope %>.
        HISTORY.length > 0
    )
        {
            let last = <%= scope %>.
            HISTORY[<%= scope %>.HISTORY.length - 1
        ]
            ;
            document.getElementById("closeModal").innerHTML = `<i class='icon-arrow-left8'></i> ${last.titulo}`;
            document.getElementById("closeModal").title = last.titulo;
        }
        document.getElementById("closeModal").onclick = function () {
            <%= scope %>.
            ui.restore();
        };
    }, 100);
    <%= scope %>.inputBuscado = "";
    <%= scope %>.refreshAngular();
</script>
