<div class="row"></div>
<div class="tab-content">
    <div class="tab-pane active" id="basic">
        <div class="panel panel-default">
            <div class="panel-heading" style="padding: 5px 10px 0 10px; background-color: #f4f4f4;">
                <label style="font-family: 'Arial Narrow'; font-size: 21px;">Información</label>
            </div>
            <div class="panel-body" style="padding-bottom: 0;">
                <div class="row">
                    <div class='col-sm-3 col-md-3'>
                        <%- FORM.inputview('nombre', scope, {}) %>
                    </div>
                    <div class='col-sm-3 col-md-3'>
                        <%- FORM.daterange('range_date', scope, {
                            from: "fecha_inicio",
                            to: "fecha_fin",
                            disabled: true
                        }) %>
                    </div>
                    <div class='col-sm-2 col-md-2'>
                        <%- FORM.select('tipo_auditoria', scope, {
                            allowedit: false,
                            allowlist: false,
                            allownew: false,
                            allowview: false,
                            disabled: true,
                            text: "item.nombre",
                            value: "id",
                            table: "tipo_auditorias",
                            icon: {class: "archive"},
                            truelabel: "Tipo de Auditoría"
                        }) %>
                    </div>
                    <div class='col-sm-2 col-md-2'>
                        <%- FORM.select('prioridad', scope, {
                            allowedit: false,
                            allowlist: false,
                            allownew: false,
                            allowview: false,
                            disabled: true,
                            text: "item.nombre",
                            value: "id",
                            table: "auditoria_programa_plan_prioridad",
                            icon: {class: "archive"},
                            truelabel: "Prioridad"
                        }) %>
                    </div>
                    <div class='col-sm-2 col-md-2'>
                        <%- FORM.select('estatus_view', scope, {
                            allowedit: false,
                            allowlist: false,
                            allownew: false,
                            allowview: false,
                            disabled: true,
                            text: "item.nombre",
                            value: "id",
                            table: "vw_auditoria_programa_plan_estatus",
                            condition: "item.entidad == 'auditoria_programa_plan'",
                            icon: {class: "archive"},
                            truelabel: "Estatus",
                        }) %>
                    </div>
                </div>
                <div class="row">
                    <div class='col-sm-6 col-md-6'>
                        <%- FORM.textarea('descripcion', scope, {
                            disabled: true
                            //maxlength: 200,
                        }) %>
                    </div>
                    <div class='col-sm-6 col-md-6'>
                        <%- FORM.textarea('objetivo', scope, {
                            trueplaceholder: "Objetivo",
                            disabled: true
                            //maxlength: 200,
                        }) %>
                    </div>
                </div>
                <div class="row">
                    <div class='col-sm-6 col-md-6'>
                        <%- FORM.textarea('criterio', scope, {
                            disabled: true,
                            trueplaceholder: "Criterio de Auditoría"
                            //maxlength: 200,
                        }) %>
                    </div>

                    <div class='col-sm-6 col-md-6'>
                        <%- FORM.textarea('alcance', scope, {
                            disabled: true,
                            //maxlength: 200,
                        }) %>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-12 col-md-4" style="margin-top: 0px">
                        <div ng-show="false">
                            <%- FORM.select("auditoria_plan_departamento", scope, {
                                allowedit: false,
                                allowlist: false,
                                allownew: false,
                                allowview: false,
                                multiple: true,
                                text: "item.nombre",
                                value: "id",
                                table: "departamento",
                                icon: {class: "archive"},
                                truelabel: "Departamentos Auditados",
                                condition: "(item.compania == auditoria_programa_plan.session.compania_id && item.institucion == $null) && (item.active)",
                                get: {
                                    table: 'auditoria_programa_plan_departamento',
                                    fieldFrom: 'id',
                                    fieldTo: 'programa_plan',
                                    field: 'departamento'
                                },
                                // parent: {
                                //     model: 'eje_estrategico',
                                //     myfield: 'id',
                                //     sufield: 'id'
                                // },
                            }) %>
                        </div>
                        <label class="control-label is-visible animate ng-binding"
                               style="font-family: 'Outfit',Helvetica Neue,Helvetica,Arial,sans-serif; font-size: 15px; color:#000000 !important;">
                            Departamentos Auditados
                        </label>
                        <ol ng-show="auditoria_programa_plan.departamento_list.data.length > 0" style="">
                            <li ng-repeat="(key,row) in auditoria_programa_plan.departamento_list.data" class=""
                                style="font-family: 'Outfit',Helvetica Neue,Helvetica,Arial,sans-serif; font-size: 15px; color: #888888 !important">
                                {{row.nombre}}
                            </li>
                        </ol>
                    </div>
                    <div class="col-sm-12 col-md-4" style="margin-top: 0px">
                        <div ng-show="false">
                            <%- FORM.select("auditoria_plan_participantes", scope, {
                                allowedit: false,
                                allowlist: false,
                                allownew: false,
                                allowview: false,
                                multiple: true,
                                text: "item.nombre + ' ' + item.apellido",
                                value: "id",
                                table: "usuario",
                                icon: {class: "archive"},
                                truelabel: "Participantes",
                                get: {
                                    table: 'auditoria_programa_plan_participantes',
                                    fieldFrom: 'id',
                                    fieldTo: 'programa_plan',
                                    field: 'usuario',
                                },
                                // parent: {
                                //     model: 'eje_estrategico',
                                //     myfield: 'id',
                                //     sufield: 'id'
                                // },
                            }) %>
                        </div>
                        <label style="font-family: 'Outfit',Helvetica Neue,Helvetica,Arial,sans-serif; font-size: 15px;">
                            Participantes Departamentales del Plan de Auditoría</label>
                        <ol ng-show="auditoria_programa_plan.real_participantes_list.data.length > 0" style="">
                            <li ng-repeat="(key,row) in auditoria_programa_plan.real_participantes_list.data" class=""
                                style="font-family: 'Outfit',Helvetica Neue,Helvetica,Arial,sans-serif; font-size: 15px; color: #888888 !important">
                                {{row.nombre + ' ' + row.apellido}} ({{row.departamento}})
                            </li>
                        </ol>
                    </div>
                    <div class="col-sm-12 col-md-4" style="margin-top: 0px">
                        <div ng-show="false">
                            <%- FORM.select("auditoria_plan_responsable", scope, {
                                allowedit: false,
                                allowlist: false,
                                allownew: false,
                                allowview: false,
                                multiple: true,
                                text: "item.nombre + ' ' + item.apellido",
                                value: "id",
                                table: "usuario",
                                icon: {class: "archive"},
                                truelabel: "Participantes",
                                get: {
                                    table: 'auditoria_programa_plan_equipotrabajo',
                                    fieldFrom: 'id',
                                    fieldTo: 'programa_plan',
                                    field: 'usuario',
                                    where_delete: {
                                        field: "esresponsable",
                                        operator: "is",
                                        value: "$null"
                                    }
                                },
                                // parent: {
                                //     model: 'eje_estrategico',
                                //     myfield: 'id',
                                //     sufield: 'id'
                                // },
                            }) %>
                        </div>
                        <label class="control-label is-visible animate ng-binding"
                               style="font-family: 'Outfit',Helvetica Neue,Helvetica,Arial,sans-serif; font-size: 15px; color:#000000 !important;">
                            Auditores Participantes
                        </label>
                        <ol ng-show="auditoria_programa_plan.participantes_list.data.length > 0" style="">
                            <li ng-repeat="(key,row) in auditoria_programa_plan.participantes_list.data" class=""
                                style="font-family: 'Outfit',Helvetica Neue,Helvetica,Arial,sans-serif; font-size: 15px; color: #888888 !important">
                                {{row.nombre + ' ' + row.apellido}} {{auditoria_programa_plan.get_rol(row.id)}}
                            </li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12 col-md-12" style="padding-left: 0; margin-top: -15px">
            <div ng-show="false"><%- FORM.select("auditoria_plan_documentos_asociados", scope, {
                    allowedit: false,
                    allowlist: false,
                    allownew: false,
                    allowview: false,
                    multiple: true,
                    text: "item.nombre_drp",
                    value: "id",
                    table: "vw_documentos_asociados_pv",
                    icon: {class: "archive"},
                    truelabel: "Documentos Asociados",
                    get: {
                        table: 'auditoria_programa_plan_documentos_asociados',
                        fieldFrom: 'id',
                        fieldTo: 'programa_plan',
                        field: 'documento_asociado',
                        where_delete: {
                            field: "trabajado",
                            operator: "!=",
                            value: 1
                        }
                    },
                    // parent: {
                    //     model: 'eje_estrategico',
                    //     myfield: 'id',
                    //     sufield: 'id'
                    // },
                }) %></div>
            <div class="panel panel-default" style="margin-left: 10px; margin-bottom: 0px;">
                <div class="panel-heading" style="padding: 5px 10px 0 10px; background-color: #f4f4f4;">
                    <label style="font-family: 'Arial Narrow'; font-size: 18px;">Procesos y Documentos a Auditar</label>
                </div>
                <div class="panel-body">
                    <table class=" table table-bordered"
                           ng-show="auditoria_programa_plan.documentos_asociados_list.data.length > 0"
                           style="margin-top: -15px;">
                        <thead class="">
                        <tr class="bg-secundary">
                            <th style="text-align: center; vertical-align: middle" height="0">
                                <a style="cursor: pointer;color: #FFF !important;text-decoration: underline"
                                   class="ng-binding ng-scope">
                                    Proceso
                                </a>
                            </th>
                            <th style="text-align: center; vertical-align: middle" height="0">
                                <a style="cursor: pointer;color: #FFF !important;text-decoration: underline"
                                   class="ng-binding ng-scope">
                                    Responsable del proceso
                                </a>
                            </th>
                            <th style="text-align: center; vertical-align: middle" height="0">
                                <a style="cursor: pointer;color: #FFF !important;text-decoration: underline"
                                   class="ng-binding ng-scope">
                                    Código - Nombre del Documento
                                </a>
                            </th>
                            <th style="text-align: center; vertical-align: middle" height="0">
                                <a style="cursor: pointer;color: #FFF !important;text-decoration: underline"
                                   class="ng-binding ng-scope">
                                    Auditor Responsable de Auditar Documento
                                </a>
                            </th>
                            <th style="text-align: center; vertical-align: middle" height="0">
                                <a style="cursor: pointer;color: #FFF !important;text-decoration: underline"
                                   class="ng-binding ng-scope">
                                    Punto de Verificación
                                </a>
                            </th>
                            <th style="text-align: center; vertical-align: middle" height="0">
                                <a style="cursor: pointer;color: #FFF !important;text-decoration: underline"
                                   class="ng-binding ng-scope">
                                    ¿Cumple?
                                </a>
                            </th>
                            <th style="text-align: center; vertical-align: middle" height="0">
                                <a style="cursor: pointer;color: #FFF !important;text-decoration: underline"
                                   class="ng-binding ng-scope">
                                    Tipo de No Conformidad
                                </a>
                            </th>
                            <th style="text-align: center; vertical-align: middle" height="0">
                                <a style="cursor: pointer;color: #FFF !important;text-decoration: underline"
                                   class="ng-binding ng-scope">
                                    Observación
                                </a>
                            </th>
                            <th style="text-align: center; vertical-align: middle" height="0">
                                <a style="cursor: pointer;color: #FFF !important;text-decoration: underline"
                                   class="ng-binding ng-scope">
                                    Evidencia
                                </a>
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="(key,row) in auditoria_programa_plan.documentos_asociados_list_view.data"
                            repeat-end="auditoria_programa_plan.get_files()" class=""
                            style="font-family: 'Arial Narrow';font-size: 15px; text-align: center; vertical-align: middle">
                            <td
                                    rowspan="{{auditoria_programa_plan.rowspanme('nombre_proceso', row.nombre_proceso, auditoria_programa_plan.documentos_asociados_list_view.data)}}"
                                    ng-if="auditoria_programa_plan.seeme('nombre_proceso', row.nombre_proceso, key, auditoria_programa_plan.documentos_asociados_list_view.data)">
                                {{row.nombre_proceso}}
                            </td>
                            <td
                                    rowspan="{{auditoria_programa_plan.rowspanme('responsable_proceso', row.responsable_proceso, auditoria_programa_plan.documentos_asociados_list_view.data)}}"
                                    ng-if="auditoria_programa_plan.seeme('responsable_proceso', row.responsable_proceso, key, auditoria_programa_plan.documentos_asociados_list_view.data)"
                            >
                                {{row.responsable_proceso}}
                            </td>
                            <td
                                    rowspan="{{auditoria_programa_plan.rowspanme('codigo', row.codigo, auditoria_programa_plan.documentos_asociados_list_view.data)}}"
                                    ng-if="auditoria_programa_plan.seeme('codigo', row.codigo, key, auditoria_programa_plan.documentos_asociados_list_view.data)"
                            >
                                {{row.codigo}} - {{row.nombre}}
                            </td>
                            <td rowspan="{{auditoria_programa_plan.rowspanme('responsable_ducumento', row.responsable_ducumento, auditoria_programa_plan.documentos_asociados_list_view.data)}}"
                                ng-if="auditoria_programa_plan.seeme('responsable_ducumento', row.responsable_ducumento, key, auditoria_programa_plan.documentos_asociados_list_view.data)">
                                {{row.responsable_ducumento}}
                            </td>
                            <td>
                                {{row.punto_verificacion}}
                            </td>
                            <td>
                                {{row.cumple == 1 ? 'Sí' : row.cumple == 0 ? 'No' : '' }}
                            </td>
                            <td>
                                {{row.tipo_inconformidad}}
                            </td>
                            <td>
                                {{row.observaciones}}
                            </td>
                            <td>
                                <a title='Ver imagen' ng-click="auditoria_programa_plan.verFile('archivo','',row);"><i
                                            class='icon-files-empty'
                                            ng-show="auditoria_programa_plan.check_file(row)"></i>
                                </a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class='col-sm-6 col-md-6' style="padding-right: 0">
            <div class="tab-pane active">
                <div class="panel panel-default">
                    <div class="panel-heading" style="padding: 5px 10px 0 10px; background-color: #f4f4f4;">
                        <label style="font-family: 'Arial Narrow'; font-size: 18px;">Recomendaciones de Mejora,
                            Sugerencias y Comentarios Finales de los Auditores</label>
                    </div>
                    <div class="panel-body" style="max-height: 500px; overflow: auto;">
                        <div ng-bind-html="auditoria_programa_plan.recomendaciones"
                             ng-if="auditoria_programa_plan.recomendaciones"
                             style="border: solid 1px lightgrey; margin-bottom: 10px; padding: 10px; text-align: justify;">

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class='col-sm-6 col-md-6' style="padding-left: 0">
            <div class="tab-pane active">
                <div class="panel panel-default">
                    <div class="panel-heading" style="padding: 5px 10px 0 10px; background-color: #f4f4f4;">
                        <label style="font-family: 'Arial Narrow'; font-size: 18px;">Puntos de Vista de los
                            participantes departamentales</label>
                    </div>
                    <div class="panel-body" style="max-height: 500px; overflow: auto;">
                        <div ng-repeat="(key, row) in auditoria_programa_plan.informes_auditoria.data"
                             style="border: solid 1px lightgrey; margin-bottom: 10px; padding: 10px">
                            <div style="margin-bottom: 0; text-align: justify;">
                                <p ng-bind-html="row.recomendaciones"></p>
                                <strong style="float: right; margin-top: -20px"> - {{row.creadopor_nombre}}</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<br>
<div class="modal-footer dragonformfooter" dragonlanguage="" id="btnformfooter" style="padding-right: 0">
     <span class="label label-white text-<%= COLOR.secundary %>-300 label-rounded label-icon">
            <i class="position-right"></i>
     </span>
    <button

            dragonlanguage="" title="MESSAGE.ic('mono.cancel')"
            type="button" class="btn bg-<%= COLOR.warning %> btn-labeled btn-xs pull-right"
            ng-click="<%= scope %>.closeModal()">
        <b><i class="icon-cross2"></i></b>
        <language>MESSAGE.ic('mono.cancel')</language>
    </button>
    <button ng-show="<%= scope %>.estatus > 6"

            dragonlanguage="" title="Exportar informe Preliminar"
            type="button" class="btn bg-<%= COLOR.primary %> btn-labeled btn-xs pull-right"
            ng-click="<%= scope %>.export_informe(auditoria_programa_plan.nombre)">
        <b><i class="icon-file-xml2"></i></b>
        <language>Exportar informe Preliminar</language>
    </button>
</div>

<div class="" id="informe_preliminar" style="display: none">
    <table class="table table-bordered">
        <thead class="">
        <tr>
            <th colspan="1" style="text-align: left">Institución:</th>
            <td colspan="4">{{auditoria_programa_plan.session.compania}}</td>
        </tr>
        <tr>
            <th colspan="1" style="text-align: left">Informe Preliminar:</th>
            <td colspan="4" class="">Informe preliminar de la auditoría: {{auditoria_programa_plan.nombre}}</td>
        </tr>
        <tr>
            <th colspan="1" style="text-align: left">Auditoría:</th>
            <td colspan="4" class="">{{auditoria_programa_plan.nombre}}</td>
        </tr>
        <tr>
            <th colspan="1" style="text-align: left">Fecha del informe:</th>
            <td colspan="4" class="">{{auditoria_programa_plan.get_date()}}</td>
        </tr>
        </thead>
        <tbody class="">
            <tr>
                <th colspan="5" style="background-color: #f5f5f5">Objetivo</th>
            </tr>
            <tr class="">
                <td colspan="5">{{auditoria_programa_plan.objetivo}}</td>
            </tr>
            <tr>
                <th colspan="5" style="background-color: #f5f5f5">Alcance</th>
            </tr>
            <tr class="">
                <td colspan="5">{{auditoria_programa_plan.alcance}}</td>
            </tr>
            <tr >
                <th colspan="5" style="background-color: #f5f5f5; text-align: center">Departamentos Involucrados en la Auditoría</th>
            </tr>
            <tr>
                <td colspan="5" style="text-align: center; list-style-position: inside">
                    <ul>
                        <li ng-repeat="(key1, value1) in auditoria_programa_plan.departamento_list.data">
                            {{value1.nombre}}
                        </li>
                    </ul>
                </td>
            </tr>
            <tr>
                <th colspan="3" style="background-color: #f5f5f5;">Participantes Departamentales</th>
                <th colspan="2" style="background-color: #f5f5f5;">Auditores Participantes</th>
            </tr>
            <tr>
                <td colspan="3">
                    <ul>
                        <li ng-repeat="(key2, value2) in auditoria_programa_plan.participantes_list.data">
                            {{value2.nombre + " " + value2.apellido + (value2.departamento)}}
                        </li>
                    </ul>
                </td>
                <td colspan="2">
                    <ul>
                        <li ng-repeat="(key3, value3) in auditoria_programa_plan.participantes_list.data">
                            {{value3.nombre + ' ' + value3.apellido}} {{auditoria_programa_plan.get_rol(value3.id)}}
                        </li>
                    </ul>
                </td>
            </tr>
            <tr>
                <th colspan="5" style="background-color: #f5f5f5;text-align: center;">Hallazgos Encontrados</th>
            </tr>
            <tr>
                <th>Proceso</th>
                <th>Documento</th>
                <th>Punto de Verificación</th>
                <th>Tipo</th>
                <th>Observación</th>
            </tr>
            <tr ng-repeat="(key4,value4) in auditoria_programa_plan.documentos_asociados_list_view.data"style="font-family: 'Arial Narrow';font-size: 15px; text-align: center; vertical-align: middle">
                <td
                        rowspan="{{auditoria_programa_plan.rowspanme('nombre_proceso', value4.nombre_proceso, auditoria_programa_plan.documentos_asociados_list_view.data)}}"
                        ng-if="auditoria_programa_plan.seeme('nombre_proceso', value4.nombre_proceso, key4, auditoria_programa_plan.documentos_asociados_list_view.data)">
                    {{value4.nombre_proceso}}
                </td>
                <td
                        rowspan="{{auditoria_programa_plan.rowspanme('codigo', value4.codigo, auditoria_programa_plan.documentos_asociados_list_view.data)}}"
                        ng-if="auditoria_programa_plan.seeme('codigo', value4.codigo, key4, auditoria_programa_plan.documentos_asociados_list_view.data)"
                >
                    {{value4.codigo}} - {{value4.nombre}}
                </td>
                <td>
                    {{value4.punto_verificacion}}
                </td>
                <td>
                    {{value4.tipo_inconformidad}}
                </td>
                <td>
                    {{value4.observaciones}}
                </td>
            </tr>
            <tr>
                <th colspan="3" style="background-color: #f5f5f5;">Punto de Vista de los Auditados</th>
                <th colspan="2" style="background-color: #f5f5f5;">Departamento</th>
            </tr>
            <tr ng-repeat="(key5, value5) in auditoria_programa_plan.informes_auditoria.data">
                <td colspan="3" style="text-align: center;"><p ng-bind-html="value5.recomendaciones"></p></td>
                <td colspan="2" style="text-align: center;">{{value5.departamento}}</td>
            </tr>
            <tr>
                <th colspan="5" style="background-color: #f5f5f5;">Recomendaciones de Mejora</th>
            </tr>
            <tr>
                <td colspan="5">
                    <div><p ng-bind-html="auditoria_programa_plan.recomendaciones"></p></div>
                </td>
            </tr>
        </tbody>
    </table>
</div>





